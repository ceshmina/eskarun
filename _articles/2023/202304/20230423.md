特に予定はなかったので、昨日Goで作っていたアプリの続き。クリーンアーキテクチャもどきで作っていたのでテスト自体はやりやすいのだが、プライベートメソッドのテストですこし詰まった。

外から呼ばないがテストはしたい、といったメソッドをすべてインターフェースに定義してしまうと、別の層でモックするときに不要な実装をする必要があって困る。解決策としては、本来のインターフェースには外から呼ぶメソッドのみ定義しておき、すべてのメソッドを含めたテスト用のインターフェースを別途定義しておけばいい。本番の実装はどちらの定義も満たすはずなので、これで動く。モックするときは外から呼ぶメソッドだけ実装されていれば十分なので、普通に本来のインターフェースを使えばOK。

---

夜はRustのチュートリアルを読んでいた。GoがJavaっぽいのに対して、RustはC++っぽい印象。Goより機能は充実している。Goでも詰まったところだが、ファイル分割の記法がややこしい...
